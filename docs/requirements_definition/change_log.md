# 変更要件ログ (Change Log)

本ドキュメントは、ユーザーからの追加要件および修正依頼を時系列順に記録するものである。

## Phase 9 (続き)

### [2025-12-23] ドキュメント化の要請

* **要件**: 今後の追加要件や修正要求をすべてドキュメント化すること。
* **対応**: `docs/requirements_definition/change_log.md` を作成し、以降の依頼をここに追記する運用を開始。

### [2025-12-23] 設定画面の視認性改善

* **不具合**: 設定画面「アカウント・セキュリティ」セクションにおいて、連携アカウント表示の文字色が背景色と同化して見えない。
* **対応**: 文字色と背景色のコントラストを修正し、視認性を確保する。

### [2025-12-23] マルチペット管理機能の実装

* **要件**:
    1. **マルチペット管理**: 複数のペットを個別登録・管理し、ペットごとの表示切り替え（フィルタリング）を可能にする。
    2. **詳細プロフィール**: 名前、種類、品種、性別、誕生日、お迎え日（うちの子記念日）を登録可能にする。
* **計画**:
  * DB: `Pet`モデルの作成/拡張、`Media`-`Pet`間の多対多リレーション構築。
  * UI: 設定画面でのペット登録・編集フォーム追加。
  * UI: アップロード/編集画面でのペットタグ付け機能。
  * UI: タイムラインでのペット絞り込み機能。

### [2025-12-23] ペット追加モーダルの表示修正

* **不具合**: ペット追加モーダル内のプルダウン（セレクトボックス）において、選択肢の文字色が背景色と被って見えない（白文字 on 白背景）。
* **対応**: `<option>`要素の文字色を黒に指定し、視認性を確保する。

### [2025-12-23] 設定画面の機能実装 (退出・編集)

* **不具合**: 設定画面の「家族からの退出」ボタンと「ペット情報の編集」ボタンが動作しない（disabled状態）。
* **要件**: 上記2つのボタンを有効化し、機能を実装する。
  * **ペット編集**: 登録済みペットの情報を修正できるようにする。
  * **家族退出**: 所属している家族から抜ける機能を実装する（確認モーダル必須）。

### [2025-12-23] お気に入り機能の実装

* **要件**: メディアに対して「お気に入り（いいね）」を付ける機能を追加する。
* **機能詳細**:
  * メディアにお気に入りボタン（ハートマーク）を表示。
  * タップでお気に入り登録/解除を切り替え（トグル）。
  * お気に入りしたメディアのみを表示するフィルタリング機能。
* **DB変更**: `favorites` テーブル（中間テーブル）の追加。

### [2025-12-23] フィルターUIの改善

* **課題**: 以前のフィルター表示では「並び替え」機能が欠けており、かつレイアウトが複数行に渡り視認性が悪かった。
* **対応**:
  * フィルターボタン群（すべて、お気に入り、写真のみ、動画のみ）と並び替えプルダウンを1行に集約。
  * `flexbox` を活用し、レスポンシブかつコンパクトなレイアウトに変更。
  * PC画面など横幅が十分な場合は横一列に配置し、視認性を向上。

### [2025-12-23] UI/UX 調整 (ヘッダー・レイアウト)

* **要件**:
  * メニューバーとコンテンツの間の余白が広すぎるため縮小する。
  * メニューバーの色を調整し、ダークモード時の視認性とブランド感を向上させる。
* **対応**:
  * `.container` の上部パディングを `32px` から `20px` に縮小。
  * ヘッダー背景色をダークモード時に「深いネイビー (`rgba(20, 30, 60, 0.85)`)」に変更し、少し青みを加えることでリッチな印象に。

### [2025-12-23] ダークモード切替機能の実装

* **要件**: ユーザーが手動でライトモード/ダークモードを切り替えられるボタンを設置する。
* **実装**:
  * ヘッダー（ログアウトボタン横）にテーマ切替ボタン（🌞/🌙）を追加。
  * `localStorage` に設定を保存し、次回訪問時も状態を維持。
  * CSS変数を `[data-theme]` 属性で制御できるように拡張し、システム設定 (`prefers-color-scheme`) よりもユーザー設定を優先するロジックを実装。

### [2025-12-23] 「Family（家族）」属性の完全削除

* **要件**: アプリケーションから「家族」という概念と、家族単位でのデータ分割ロジックを完全に削除する。
* **理由**: 全ユーザーで共有する単一のスペースとして運用するため。
* **対応**:
  * **モデル**: `Family`, `FamilyMember` モデルを削除。`Media`, `PetProfile` 等から `family_id` を削除。
  * **サービス**: `FamilyService` を廃止し、`MediaService` のアップロード・取得ロジックをグローバル対応へ変更。
  * **DB**: 大規模なスキーマ変更に伴い、データベースをリセット (`migrations` 再生成)。
  * **UI**: 設定画面から「家族・ペット管理」セクションを削除。アップロード時の家族選択ロジックを撤廃。

### [2025-12-23] ヘッダー表示不具合の修正

* **不具合**: 特定のCSS変更リバート後、ヘッダーの幅が狭くなり、かつ画像がヘッダーの上に重なるようになった。
* **原因**: `style.css` 編集時の記述ミスにより `header { ... }` セレクタが消失し、スタイルが適用されていなかった。
* **対応**: `header` セレクタを復元し、`z-index` を `999` に設定して画像被りを防止。

### [2025-12-23] モバイル時のテーマ切替ボタン非表示

* **要件**: スマホ表示時（画面幅が狭い場合）は、ヘッダーのスペース確保のためテーマ切替ボタンを表示しない。
* **対応**:
  * CSSに `.mobile-hidden` ユーティリティクラスを追加 (`@media (max-width: 768px)` で `display: none !important`)。
  * テーマ切替ボタンのラッパー要素に同クラスを適用。
  * キャッシュ対策としてCSS読み込みURLにバージョンクエリ (`?v=2`) を付与。

### [2025-12-23] ペット一覧およびナビゲーションの改善

* **要件**:
  * ナビゲーションメニューのテキストを「ペット一覧」から「ペット紹介」に変更。
  * スクロール時にナビゲーションメニューが画面上部に固定されるようにする（Stickyヘッダー）。
* **対応**:
  * `base.html` および `pets.html` の文言を修正。
  * `style.css` にて `.main-nav` に `position: sticky; top: var(--header-height);` を適用し、スクロール追従を実装。

### [2025-12-23] ペット一覧デザインの刷新と機能強化

* **要件**:
  * ペットリストを「Hero Profile」スタイル（大きなアバターとテキストのカードデザイン）に変更。
  * ペットのアバター画像（アイコン）を設定機能を追加。
  * 自己紹介（bio）や性格などのメモを記録・編集できる機能を追加。
  * 編集時に画像の切り抜き（クロッピング）ができるようにする。
* **対応**:
  * **デザイン刷新**: `pets.html` のリスト表示を刷新。アバター画像を大きく配置し、`background-image` を使用して画像の歪みを防止。
  * **アバター機能**: `media.py` (Model) と `pet_service.py` を更新し、アバター画像の保存・更新を実装。
  * **画像切り抜き**: `Cropper.js` を導入し、正方形へのクリッピング機能を追加。
  * **自己紹介機能**: `PetProfile` モデルに `description` カラムを追加し、編集モーダルと一覧表示に反映。
  * **モーダル改善**: 編集モーダルのタイトルを「ペット情報」に統一し、アイコン編集のプレビュー機能を追加。
  * **UI修正**: 背景色と同化していたモーダルの「×」ボタンの色を修正。テキストエリアのサイズ固定化 (`resize: none`)。

### [2025-12-24] モバイルUIおよびUXの改善

* **要件**:
  * スマホ表示時のタイムライン（ホーム画面）を2列表示にする。
  * 各メディアの日付・名前表示をコンパクトにする（2行表示、縦並び）。
  * 動画再生時（ライトボックス）のUIパーツ被りを解消する。
  * ログイン画面を親しみやすいデザインに変更する。
  * アップロードボタン（FAB）の見た目を調整する。
* **対応**:
  * **モバイルレイアウト**: `style.css` にてスマホ時 (`max-width: 768px`) のグリッドを `repeat(2, 1fr)` に変更。パディングを調整。
  * **情報表示**: 投稿者名と日時を縦並び (`flex-direction: column`) にし、フォントサイズと行間を縮小。
  * **ライトボックス**: 閉じるボタンを右上（アイコン被り回避のため位置調整）、情報テキストを下部に配置。動画の高さを `65vh` に制限し、上下のセーフエリアを確保。
  * **ログイン画面**: アプリロゴ画像 (`app_icon.jpg`) を使用し、ウェルカムメッセージを「わんちゃん・ねこちゃんとの大切な思い出をシェアしよう🐾」に変更。
  * **FAB調整**: サイズを縮小 (52px)、背景を半透明 (opacity 0.6 + blur) に変更。ホバー/タップ時は不透明にするインタラクションを追加。
